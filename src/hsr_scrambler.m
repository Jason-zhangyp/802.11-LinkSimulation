function [data_out] = hsr_scrambler(initial_state,data_in)
%HSR_SCRAMBLER Scrambler for IEEE 802.11a / Hiperlan2
%
%  DATA_OUT = HSR_SCRAMBLER (INITIAL_STATE, DATA_IN)
%    scrambles the bit sequence in DATA_IN with the IEEE802.11a scrambling
%    sequence. INITIAL_STATE must be a non-negative integer indicating the
%    starting point of the scrambling sequence.

%History:
%  Andre Noll Barreto  25.07.2001  created


 scr_seq = [0,0,0,0,1,1,1,0,...
            1,1,1,1,0,0,1,0,...
            1,1,0,0,1,0,0,1,...
            0,0,0,0,0,0,1,0,...
            0,0,1,0,0,1,1,0,...
            0,0,1,0,1,1,1,0,...
            1,0,1,1,0,1,1,0,...
            0,0,0,0,1,1,0,0,...
            1,1,0,1,0,1,0,0,...
            1,1,1,0,0,1,1,1,...
            1,0,1,1,0,1,0,0,...
            0,0,1,0,1,0,1,0,...
            1,1,1,1,1,0,1,0,...
            0,1,0,1,0,0,0,1,...
            1,0,1,1,1,0,0,0,...
            1,1,1,1,1,1,1];

len = length(data_in);
n = ceil((len+initial_state)/127);
scr_seq = repmat(scr_seq,1,n);
data_out = xor(data_in,scr_seq((initial_state+1):(initial_state+len)));

